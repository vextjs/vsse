# 项目状态（STATUS / ROADMAP）

## 能力矩阵（当前）
- [x] 聊天对话（OpenAI，非流式）
- [x] 流式对话（Replicate + SSE）
- [x] 右侧需求卡渲染（SSE 推送 HTML）
- [x] 航班 JSON → HTML 渲染
- [x] **防重复连接保护** 🛡️（v0.2.0 新增）- 单个实例内自动防止不规范代码导致的重复连接
- [x] **连接状态诊断工具**（v0.2.0 新增）- `getConnectionInfo()` 方法
- [x] **主动建立 SSE 连接**（v0.1.6 新增）- 无需 POST 请求即可建立连接
- [x] **SSE 连接自定义请求头支持**（v0.1.4 新增）
- [x] **Bearer Token 自动注入到 SSE 连接**（v0.1.4 新增）
- [x] **完整的 CORS 和跨域认证支持**（v0.1.4 新增）
- [ ] 单元测试与契约测试
- [ ] CI（Windows + Ubuntu）
- [ ] 账号体系与会话持久化

## 路线图（计划）
- 近期（0.2.x）
    - ~~增加防重复连接保护机制~~（✅ 已完成 v0.2.0）
    - ~~增加连接状态诊断工具~~（✅ 已完成 v0.2.0）
    - 增加 API 合同测试与 SSE 行为测试
    - 文档与类型声明完善
    - 引入缓存与并发去重（inflight 合并）
    - 性能与慢查询日志（命中率、p95 指标）
    - 提供原生 EventSource 和 Polyfill 的选择配置
- 中期（0.3.x）
    - 完善单元测试覆盖率
    - 添加 CI/CD 流程
- 远期（1.x）
    - 稳定公开 API，发布初版
    - 提供插件化模型供应商适配
    - 支持多种 SSE 传输模式（包括 fetch + ReadableStream 自解析）

## v0.2.0 重要更新（当前开发中）
- **核心功能**: 防重复连接保护机制 🛡️
  - 四层防护：状态检查 + 连接锁 + 防抖 + 状态机
  - 自动处理同一实例内的不规范代码（多次调用、并发调用、频繁调用）
  - 保证单个实例内的单例连接，避免资源浪费和消息重复
- **设计理念**: 实例独立，实例内防重
  - 每个 SSEClient 实例管理自己的连接，互不干扰
  - 不同 URL 可以创建多个实例，各自独立工作
  - 同一个实例内防止重复建立连接
- **诊断工具**: 新增 `getConnectionInfo()` 方法
  - 查看连接状态、尝试次数、监听器数量等信息
  - 支持生产环境监控和问题排查
- **日志增强**: 详细的日志输出
  - 所有连接操作都有对应的日志记录
  - 使用 `[vsse]` 前缀便于过滤
  - 记录连接原因（reason）和尝试次数
- **文档**: README.md 中新增防重复连接保护章节
- **性能影响**: 几乎无开销（~100 字节内存，~0.01ms CPU）
- **向后兼容**: 100% 保持原有 API 兼容性

## v0.1.6 重要更新
- **新增功能**: `connect()` 方法支持主动建立 SSE 连接，无需通过 POST 或监听器
- **使用场景**: 纯服务端推送、预连接优化、实时通知系统、多频道订阅
- **内部优化**: 将连接逻辑拆分为 `maybeConnect()` 和 `forceConnect()`
- **文档更新**: 新增完整的 API 方法说明和使用示例
- **演示页面**: 新增 `demo-connect.html` 展示主动连接功能

## v0.1.4 重要更新
- **突破性功能**: 支持 SSE 连接自定义请求头，解决了原生 EventSource 的限制
- **认证增强**: 全局 `token` 现在会自动添加到 SSE 连接
- **架构改进**: 从原生 EventSource 升级到 EventSourcePolyfill
- **文档完善**: 全面更新了使用指南和最佳实践
- **向下兼容**: 100% 保持原有 API 兼容性

注：路线图更新需同步 CHANGELOG 的 [Unreleased]。
